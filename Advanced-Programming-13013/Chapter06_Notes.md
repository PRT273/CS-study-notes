第六章：函数



6.1 函数的概念和模块化程序设计

函数是一个可以反复执行的程序段。

其中有且只能有一个main函数（称为主函数）。
在 C 语言中，函数分为：

库函数：如 printf(), scanf()

用户自定义函数：你自己写的函数



6.1.2 函数的定义

任何函数的一般形式：

返回类型  函数名(形式参数列表)

{

    函数体（若干语句）

}



如果函数无返回值，数据类型符应使用void。



6.1.3 函数的调用

一般形式：函数名（\[实际参数表]}

形参是在函数定义的时候设置的，实参是调用函数时的实际参数。

实参在数量、类型和顺序上与形参必须一一对应和匹配。



无返回值的函数 return；

有返回值的函数 return（返回值表达式）；或 return 返回值表达式。



6.2函数声明

一般格式如下：\[存储类型]\[数据类型符]函数名（形参类型\[形参名]\[,形参类型\[形参名2],...]);



用户函数：extern数据类型符 函数名（形参表）；



6.3 函数的参数和数据传递方式



值传递方式

函数调用时，c语言对值传递方式的形参变量分配内训单元，然后将实参的值保存到相应的内存单元，完成值传递；函数调用结束时，即刻自动释放分配给形参变量的内存单元，其值将丢失。实参对形参的数据传递是单向的。



数组元素可以作为函数实参（p190） 数组名也可以作为函数参数（p191）



函数体中需要有语句“return（表达式）；“其中的表达式即使函数的返回值。



6.4 变量的存储类型和作用域

1.自动型变量 （p193） 格式：\[auto] 数据类型 变量表；

2.静态型变量 （p194） 格式：static  据类型 变量表；

还有寄存器型变量和外部型变量（p195）



6.4.2 变量的生存期和作用域

变量存在生存期、作用域。根据变量生存期的不同可以分为局部变量和全局变量。



自动变量



默认类型：局部变量不写 storage class 默认就是 auto。

作用域：从进入所在的 块（{}） 开始，到块结束失效。

生存期：每次进入创建 → 退出销毁。

是否保留值？ 不保留，每次调用重新分配。



静态变量 static（非常常考）



static 关键字使变量：

只初始化一次。

整个程序运行期间一直存在。

作用域仍然局限于当前函数内部。



外部变量（全局变量）



定义在函数之外的变量。
特点：

作用域：从定义处开始 → 文件末尾

生存期：程序整个运行过程

默认值为 0



常见错误理解：

 “所有函数都可以使用全局变量”**错**

限制：只有在它之后出现的函数才能使用（作用域规则） **对**



当你要在多个函数或多个源文件间共享一个变量时使用：



extern int a;     // 声明：告诉编译器这个变量在别处定义。



作用：

不分配新内存。

不重新定义变量。

只是一种“引用声明”。



extern 不产生新变量，它只是引用已有外部变量。



6.5 函数的嵌套调用和递归调用



6.5.1 嵌套调用



注意：C 语言本身不支持在函数内部再定义函数（少数编译器扩展除外）。

“函数的嵌套调用”指的是：函数调用关系是嵌套的，而不是语法上把函数写在函数里面。



1\. 基本概念

一个函数里可以调用另外一个函数，这叫“嵌套调用”。

调用关系可以是：main → f1 → f2 → f3 …

每一次函数调用都会在\*\*栈（stack）\*\*上分配一块空间，保存：

形参

局部变量

返回地址（调用完跳回哪里）



执行过程可以理解为：



谁最后被调用，谁先执行完；

谁先调用别人，谁最后回来。



\#include <stdio.h>



void f2(void)

{

    printf("This is f2.\\n");

}



void f1(void)

{

    printf("Enter f1.\\n");

    f2();                      // 在 f1 中调用 f2

    printf("Leave f1.\\n");

}



int main(void)

{

    printf("In main.\\n");

    f1();                      // 在 main 中调用 f1

    printf("Back to main.\\n");

    return 0;

}



嵌套调用与作用域

在嵌套调用中，每个函数有自己的 局部变量 和 形参；

全局变量可以在多个函数中共用；

如果局部变量和全局变量同名，函数内部优先使用局部变量（屏蔽全局）。





6.5.2 递归调用



概念

递归函数：在函数体内部直接或间接调用自己的函数。

直接递归：函数 f 的函数体中直接出现 f()。

间接递归：f1 → f2 → … → f1 形成环。



递归函数必须满足两个条件：



终止条件（边界条件）：满足某种简单情况时，不再调用自己，直接返回结果；

递归表达式：在一般情况下，把问题转化为规模更小的同类问题，通过再次调用自己解决。



如果没有终止条件，或者规模没有变小，就会陷入死递归，程序崩溃（栈溢出）。



阶乘 n! 的递归表示（经典例子）

数学上定义：

0! = 1，1! = 1

n! = n × (n-1)! （n ≥ 2）



long fac(int n)

{

    if (n == 0 || n == 1)      // 终止条件：n = 0 或 1 时不再递归

        return 1;

    else                       // 一般情况：n! = n \* (n-1)!

        return n \* fac(n - 1);

}



6.6 常用库函数 （p205~p210） 



6.7函数的设计实例（p210~p213）

